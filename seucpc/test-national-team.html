<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å›½å®¶é›†è®­é˜ŸåŠŸèƒ½æµ‹è¯•</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body { padding: 20px; }
    .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    .test-section h3 { margin-top: 0; }
    .btn { margin: 5px; }
    .log { 
      background: #f5f5f5; 
      padding: 10px; 
      margin: 10px 0; 
      border-radius: 5px; 
      max-height: 300px; 
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
    }
    .log-entry { margin: 2px 0; }
    .success { color: green; }
    .error { color: red; }
    .info { color: blue; }
  </style>
</head>
<body>
  <h1>ğŸ† å›½å®¶é›†è®­é˜ŸåŠŸèƒ½æµ‹è¯•</h1>
  
  <div class="test-section">
    <h3>æµ‹è¯•è¯´æ˜</h3>
    <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯•å›½å®¶é›†è®­é˜Ÿç›¸å…³åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
    <ul>
      <li>æµ‹è¯•1: æ˜¾ç¤ºå›½å®¶é›†è®­é˜Ÿé€‰æ‹©å¼¹çª—</li>
      <li>æµ‹è¯•2: è¿›å…¥å›½å®¶é›†è®­é˜Ÿæµç¨‹</li>
      <li>æµ‹è¯•3: IOIæ™‹çº§è®¡ç®—</li>
      <li>æµ‹è¯•4: IOIç»“æœè®¡ç®—</li>
    </ul>
  </div>
  
  <div class="test-section">
    <h3>æµ‹è¯•æ§åˆ¶</h3>
    <button class="btn" onclick="testShowNationalTeamChoice()">æµ‹è¯•1: æ˜¾ç¤ºå›½å®¶é›†è®­é˜Ÿé€‰æ‹©</button>
    <button class="btn" onclick="testEnterNationalTeam()">æµ‹è¯•2: è¿›å…¥å›½å®¶é›†è®­é˜Ÿ</button>
    <button class="btn" onclick="testCalculateIOIQualification()">æµ‹è¯•3: è®¡ç®—IOIæ™‹çº§</button>
    <button class="btn" onclick="testCalculateIOIResults()">æµ‹è¯•4: è®¡ç®—IOIç»“æœ</button>
    <button class="btn" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
  </div>
  
  <div class="test-section">
    <h3>æµ‹è¯•æ—¥å¿—</h3>
    <div id="log-area" class="log"></div>
  </div>
  
  <!-- æ¨¡æ€åŒºåŸŸ -->
  <div id="modal-root"></div>
  
  <!-- åŠ è½½å¿…è¦çš„è„šæœ¬ -->
  <script src="lib/constants.js"></script>
  <script src="lib/utils.js"></script>
  <script src="lib/models.js"></script>
  <script src="render.js"></script>
  
  <script>
    // æ—¥å¿—å‡½æ•°
    function addLog(message, type = 'info') {
      const logArea = document.getElementById('log-area');
      const entry = document.createElement('div');
      entry.className = 'log-entry ' + type;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logArea.appendChild(entry);
      logArea.scrollTop = logArea.scrollHeight;
    }
    
    function clearLog() {
      document.getElementById('log-area').innerHTML = '';
      addLog('æ—¥å¿—å·²æ¸…é™¤', 'info');
    }
    
    // åˆå§‹åŒ–æµ‹è¯•æ¸¸æˆæ•°æ®
    function initTestGame() {
      if (!window.game) {
        window.game = new GameState();
        game.week = 20;
        game.budget = 100000;
        game.reputation = 80;
        
        // æ·»åŠ å‡ ä¸ªæµ‹è¯•å­¦ç”Ÿ
        game.students = [
          new Student('å¼ ä¸‰', 85, 88, 75),
          new Student('æå››', 82, 85, 70),
          new Student('ç‹äº”', 78, 80, 68),
          new Student('èµµå…­', 75, 77, 65)
        ];
        
        addLog('æµ‹è¯•æ¸¸æˆæ•°æ®å·²åˆå§‹åŒ–', 'success');
      }
      return game;
    }
    
    // æµ‹è¯•1: æ˜¾ç¤ºå›½å®¶é›†è®­é˜Ÿé€‰æ‹©å¼¹çª—
    function testShowNationalTeamChoice() {
      addLog('=== æµ‹è¯•1: æ˜¾ç¤ºå›½å®¶é›†è®­é˜Ÿé€‰æ‹©å¼¹çª— ===', 'info');
      
      const game = initTestGame();
      
      // æ¨¡æ‹ŸNOIæ¯”èµ›ç»“æœï¼ˆæœ‰é‡‘ç‰Œï¼‰
      const noiResults = [
        { name: 'å¼ ä¸‰', total: 650, scores: [100, 100, 100, 100, 100, 100, 50], eligible: true },
        { name: 'æå››', total: 620, scores: [100, 100, 100, 90, 100, 100, 30], eligible: true },
        { name: 'ç‹äº”', total: 550, scores: [100, 80, 90, 80, 100, 100, 0], eligible: true },
        { name: 'èµµå…­', total: 480, scores: [80, 70, 80, 70, 90, 90, 0], eligible: true }
      ];
      
      const noiMaxScore = 700;
      const passLine = 560; // é‡‘ç‰Œçº¿: 80%
      
      addLog('è°ƒç”¨ showNationalTeamChoice', 'info');
      addLog(`NOIç»“æœ: ${noiResults.length} åå­¦ç”Ÿ`, 'info');
      addLog(`æ™‹çº§çº¿: ${passLine}`, 'info');
      
      try {
        if (typeof window.showNationalTeamChoice === 'function') {
          window.showNationalTeamChoice(noiResults, noiMaxScore, passLine);
          addLog('âœ“ showNationalTeamChoice è°ƒç”¨æˆåŠŸ', 'success');
        } else {
          addLog('âœ— showNationalTeamChoice å‡½æ•°æœªå®šä¹‰', 'error');
        }
      } catch (e) {
        addLog('âœ— è°ƒç”¨å¤±è´¥: ' + e.message, 'error');
        console.error(e);
      }
    }
    
    // æµ‹è¯•2: è¿›å…¥å›½å®¶é›†è®­é˜Ÿ
    function testEnterNationalTeam() {
      addLog('=== æµ‹è¯•2: è¿›å…¥å›½å®¶é›†è®­é˜Ÿ ===', 'info');
      
      const game = initTestGame();
      const goldStudentNames = ['å¼ ä¸‰', 'æå››'];
      
      addLog(`é‡‘ç‰Œå­¦ç”Ÿ: ${goldStudentNames.join('ã€')}`, 'info');
      
      try {
        if (typeof window.enterNationalTeam === 'function') {
          window.enterNationalTeam(goldStudentNames);
          addLog('âœ“ enterNationalTeam è°ƒç”¨æˆåŠŸ', 'success');
          addLog(`æ¸¸æˆçŠ¶æ€: inNationalTeam=${game.inNationalTeam}`, 'info');
        } else {
          addLog('âœ— enterNationalTeam å‡½æ•°æœªå®šä¹‰', 'error');
        }
      } catch (e) {
        addLog('âœ— è°ƒç”¨å¤±è´¥: ' + e.message, 'error');
        console.error(e);
      }
    }
    
    // æµ‹è¯•3: è®¡ç®—IOIæ™‹çº§
    function testCalculateIOIQualification() {
      addLog('=== æµ‹è¯•3: è®¡ç®—IOIæ™‹çº§ ===', 'info');
      
      const game = initTestGame();
      
      // æ¨¡æ‹Ÿå›½å®¶é›†è®­é˜Ÿæˆç»©
      game.nationalTeamResults = {
        cttScores: [
          { studentName: 'å¼ ä¸‰', score: 250, day: 'CTT-day1-2' },
          { studentName: 'å¼ ä¸‰', score: 260, day: 'CTT-day3-4' },
          { studentName: 'æå››', score: 240, day: 'CTT-day1-2' },
          { studentName: 'æå››', score: 245, day: 'CTT-day3-4' },
          { studentName: 'ç‹äº”', score: 230, day: 'CTT-day1-2' },
          { studentName: 'ç‹äº”', score: 235, day: 'CTT-day3-4' },
          { studentName: 'èµµå…­', score: 220, day: 'CTT-day1-2' },
          { studentName: 'èµµå…­', score: 225, day: 'CTT-day3-4' }
        ],
        ctsScores: [
          { studentName: 'å¼ ä¸‰', score: 290 },
          { studentName: 'æå››', score: 280 },
          { studentName: 'ç‹äº”', score: 270 },
          { studentName: 'èµµå…­', score: 260 }
        ],
        ioiQualified: []
      };
      
      addLog('CTTæˆç»©å·²è®¾ç½®', 'info');
      addLog('CTSæˆç»©å·²è®¾ç½®', 'info');
      
      try {
        if (typeof window.calculateNationalTeamQualification === 'function') {
          window.calculateNationalTeamQualification();
          addLog('âœ“ calculateNationalTeamQualification è°ƒç”¨æˆåŠŸ', 'success');
          addLog(`IOIæ™‹çº§åå•: ${game.nationalTeamResults.ioiQualified.join('ã€')}`, 'success');
        } else {
          addLog('âœ— calculateNationalTeamQualification å‡½æ•°æœªå®šä¹‰', 'error');
        }
      } catch (e) {
        addLog('âœ— è°ƒç”¨å¤±è´¥: ' + e.message, 'error');
        console.error(e);
      }
    }
    
    // æµ‹è¯•4: è®¡ç®—IOIç»“æœ
    function testCalculateIOIResults() {
      addLog('=== æµ‹è¯•4: è®¡ç®—IOIç»“æœ ===', 'info');
      
      const game = initTestGame();
      
      // åˆå§‹åŒ–ç”Ÿæ¶¯æ¯”èµ›è®°å½•
      if (!game.careerCompetitions) game.careerCompetitions = [];
      
      // æ·»åŠ IOIæ¯”èµ›è®°å½•ï¼ˆåŒ…å«å¥–ç‰Œä¿¡æ¯ï¼‰
      game.careerCompetitions.push({
        week: 25,
        name: 'IOI',
        passedCount: 4,
        totalStudents: 4,
        entries: [
          { name: 'å¼ ä¸‰', rank: 1, score: 580, passed: true, medal: 'gold' },
          { name: 'æå››', rank: 2, score: 550, passed: true, medal: 'gold' },
          { name: 'ç‹äº”', rank: 3, score: 520, passed: true, medal: 'silver' },
          { name: 'èµµå…­', rank: 4, score: 490, passed: true, medal: 'bronze' }
        ]
      });
      
      // æ¨¡æ‹Ÿ IOI å…¨éƒ¨ç»“æœï¼ˆåŒ…å«å›½é™…é€‰æ‰‹ï¼‰
      game.lastIOIAllResults = [
        { name: 'å¼ ä¸‰', score: 580, rank: 15, isInternational: false, nationality: 'ä¸­å›½' },
        { name: 'æå››', score: 550, rank: 28, isInternational: false, nationality: 'ä¸­å›½' },
        { name: 'ç‹äº”', score: 520, rank: 45, isInternational: false, nationality: 'ä¸­å›½' },
        { name: 'èµµå…­', score: 490, rank: 68, isInternational: false, nationality: 'ä¸­å›½' }
      ];
      
      addLog('IOIæ¯”èµ›è®°å½•å·²è®¾ç½®', 'info');
      addLog('å…¨éƒ¨å‚èµ›é€‰æ‰‹æˆç»©å·²è®¾ç½®', 'info');
      
      try {
        if (typeof window.calculateIOIResults === 'function') {
          window.calculateIOIResults();
          addLog('âœ“ calculateIOIResults è°ƒç”¨æˆåŠŸ', 'success');
        } else {
          addLog('âœ— calculateIOIResults å‡½æ•°æœªå®šä¹‰', 'error');
        }
      } catch (e) {
        addLog('âœ— è°ƒç”¨å¤±è´¥: ' + e.message, 'error');
        console.error(e);
      }
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.onload = function() {
      addLog('é¡µé¢åŠ è½½å®Œæˆ', 'success');
      addLog('å¼€å§‹æ£€æŸ¥å‡½æ•°æ˜¯å¦å·²å®šä¹‰...', 'info');
      
      const functions = [
        'showNationalTeamChoice',
        'enterNationalTeam',
        'calculateNationalTeamQualification',
        'calculateIOIResults'
      ];
      
      let allDefined = true;
      for (let fname of functions) {
        if (typeof window[fname] === 'function') {
          addLog(`âœ“ ${fname} å·²å®šä¹‰`, 'success');
        } else {
          addLog(`âœ— ${fname} æœªå®šä¹‰`, 'error');
          allDefined = false;
        }
      }
      
      if (allDefined) {
        addLog('æ‰€æœ‰å›½å®¶é›†è®­é˜Ÿå‡½æ•°å‡å·²æ­£ç¡®å®šä¹‰ï¼', 'success');
      } else {
        addLog('éƒ¨åˆ†å‡½æ•°æœªå®šä¹‰ï¼Œè¯·æ£€æŸ¥ render.js', 'error');
      }
    };
  </script>
</body>
</html>
